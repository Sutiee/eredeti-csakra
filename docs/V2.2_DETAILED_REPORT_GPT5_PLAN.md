# v2.2: GPT-5 Detailed Report Generation - Implementation Plan

**Version**: 2.2
**Created**: 2025-10-18
**Status**: Approved - Ready for Implementation
**Product**: Személyre Szabott Csakra Elemzés (2,990 Ft)

---

## 1. Overview

### Product Vision
Generate a **personalized 18-20 page AI-powered chakra analysis report** using OpenAI's GPT-5 model. This is a **diagnostic analysis only** - no solution keys, no action plans, just deep personalized insights into the user's current chakra state.

### Core Principles
- **Analysis Only**: No "elsősegély terv" (first aid plan) - user explicitly requested removal
- **Personalization**: Based on 28 quiz answers + calculated chakra scores
- **Professional Quality**: Minimize bugs, professional code standards
- **Admin Accessible**: PDF saved to Supabase for re-sending to customers
- **Cost Efficient**: ~0.45 Ft per report (~$0.0015 USD)

### Technical Stack
- **AI Model**: OpenAI GPT-5 with Responses API
- **Validation**: Zod schemas for 100% JSON reliability
- **PDF Generation**: jsPDF with custom Hungarian fonts
- **Storage**: Supabase Storage (`detailed-reports` bucket)
- **Architecture**: Multi-prompt strategy (9 API calls)

---

## 2. Report Structure (18-20 Pages)

### Page Breakdown

| Page | Section | Content | Word Count |
|------|---------|---------|------------|
| 1 | **Fedlap** (Cover) | Title, user name, date, branding | - |
| 2 | **Összefoglaló** (Summary) | Master analysis: overall energy pattern, main priorities | 400-600 |
| 3 | **Csakra alapok** (Chakra Basics) | What each chakra does, why it matters | 300-400 |
| 4-10 | **Csakra részletes elemzés** (7 Chakras) | Detailed analysis per chakra (see below) | 200-600 each |
| 11 | **Kialakulás okai** (Root Causes) | Overall patterns, life events that created current state | 400-600 |
| 12-13 | **Előrejelzések** (Forecasts) | 3 time horizons (6 months, 1 year, 2 years) | 400-600 each |
| 14-15 | **Pozitív forgatókönyv** (Positive Scenario) | What could happen if user works on chakras | 600-800 |
| 16-17 | **Fix gyakorlatok** (Fixed Exercises) | Placeholder exercises (only for blocked chakras) | - |
| 18 | **Követési napló** (Tracking Journal) | Template for user to track progress | - |

### Per-Chakra Detail Page Structure (Pages 4-10)

Each of the 7 chakra pages contains:

1. **Részletes elemzés** (Detailed Analysis) - 200-600 words
   - Current state description
   - How blockage/imbalance manifests in user's life
   - Personalized based on score + answers

2. **Megnyilvánulások** (Manifestations) - 8-10 bullet points
   - **Fizikai** (Physical): 2-4 symptoms
   - **Érzelmi** (Emotional): 2-4 patterns
   - **Mentális** (Mental): 2-3 thought patterns

3. **Gyökerok** (Root Causes) - 100-400 words
   - Life events, childhood patterns, trauma that caused this
   - Personalized speculation based on chakra blockage patterns

4. **Megerősítő mondatok** (Affirmations) - 5 affirmations
   - Specific to this chakra's healing
   - Hungarian, "én" (I) statements

**REMOVED SECTION** (per user request):
- ~~**Elsősegély terv** (First Aid Plan)~~ - NO LONGER INCLUDED

---

## 3. Multi-Prompt Strategy (9 API Calls)

### Phase 1: Master Analysis (1 Call)

**Purpose**: Get overall energy pattern and priorities

**Input**:
- `chakra_scores` (7 scores, 4-16 range)
- `answers` (28 answers, 1-4 scale)
- User demographic (age group, name)

**Output** (Zod validated):
```typescript
{
  osszefoglalo: string (400-600 words),
  fo_prioritasok: string[] (3 priorities),
  kialakulasi_okok: string (400-600 words)
}
```

**GPT-5 Config**:
```typescript
{
  model: 'gpt-5',
  reasoning: { effort: 'medium' },
  text: { verbosity: 'medium' },
  max_output_tokens: 2000
}
```

---

### Phase 2: Chakra Deep Dives (7 Parallel Calls)

**Purpose**: Detailed per-chakra analysis

**Input** (per call):
- Specific chakra name + score
- 4 question answers for this chakra (1-4 scale)
- Master analysis context (priorities)

**Output** (Zod validated):
```typescript
{
  nev: string, // Chakra name
  reszletes_elemzes: string (200-600 words),
  megnyilvánulasok: {
    fizikai: string[] (2-4 items),
    erzelmi: string[] (2-4 items),
    mentalis: string[] (2-3 items)
  },
  gyokerok: string (100-400 words),
  megerosito_mondatok: string[] (5 affirmations)
}
```

**CRITICAL**: No `elsosegely_terv` field in schema

**GPT-5 Config**:
```typescript
{
  model: 'gpt-5',
  reasoning: { effort: 'medium' },
  text: { verbosity: 'medium' },
  max_output_tokens: 4000
}
```

**Execution**: `Promise.all()` for parallel processing

---

### Phase 3: Forecasts (1 Call)

**Purpose**: 3 time-horizon predictions + positive scenario

**Input**:
- All 7 chakra scores
- Master analysis summary
- Top 3 blocked chakras

**Output** (Zod validated):
```typescript
{
  hat_honap: string (400-600 words),
  egy_ev: string (400-600 words),
  ket_ev: string (400-600 words),
  pozitiv_forgatokonyvv: string (600-800 words)
}
```

**GPT-5 Config**:
```typescript
{
  model: 'gpt-5',
  reasoning: { effort: 'medium' },
  text: { verbosity: 'high' },
  max_output_tokens: 3000
}
```

---

## 4. Technical Implementation

### File Structure

```
lib/
├── openai/
│   ├── schemas-gpt5.ts          # Zod schemas (NO elsosegely_terv)
│   ├── client-gpt5.ts           # GPT-5 client config
│   ├── prompts-gpt5.ts          # Prompt builders (3 phases)
│   └── report-generator-gpt5.ts # Main orchestrator
├── pdf/
│   └── report-template-gpt5.ts  # 18-20 page PDF generator
data/
└── chakra-exercises.ts          # Fixed placeholder exercises
app/
└── api/
    └── generate-detailed-report-gpt5/
        └── route.ts             # API endpoint
```

---

### 4.1 Zod Schemas (`lib/openai/schemas-gpt5.ts`)

```typescript
import { z } from 'zod';

// Phase 1: Master Analysis
export const MasterAnalysisSchema = z.object({
  osszefoglalo: z.string().min(400).max(600),
  fo_prioritasok: z.array(z.string()).length(3),
  kialakulasi_okok: z.string().min(400).max(600),
});

// Phase 2: Per-Chakra Analysis (NO elsosegely_terv)
export const ChakraAnalysisSchema = z.object({
  nev: z.string(),
  reszletes_elemzes: z.string().min(200).max(600),
  megnyilvánulasok: z.object({
    fizikai: z.array(z.string()).min(2).max(4),
    erzelmi: z.array(z.string()).min(2).max(4),
    mentalis: z.array(z.string()).min(2).max(3),
  }),
  gyokerok: z.string().min(100).max(400),
  megerosito_mondatok: z.array(z.string()).length(5),
});

// Phase 3: Forecasts
export const ForecastSchema = z.object({
  hat_honap: z.string().min(400).max(600),
  egy_ev: z.string().min(400).max(600),
  ket_ev: z.string().min(400).max(600),
  pozitiv_forgatokonyvv: z.string().min(600).max(800),
});

// Complete Report
export const CompleteReportSchema = z.object({
  master: MasterAnalysisSchema,
  chakras: z.array(ChakraAnalysisSchema).length(7),
  forecasts: ForecastSchema,
});

export type CompleteReport = z.infer<typeof CompleteReportSchema>;
```

---

### 4.2 GPT-5 Client (`lib/openai/client-gpt5.ts`)

```typescript
import OpenAI from 'openai';

export const openaiClient = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
});

export const GPT5_CONFIG = {
  model: 'gpt-5' as const,
  reasoning: { effort: 'medium' as const },
  text: { verbosity: 'medium' as const },
  max_output_tokens: 4000,
};

export const GPT5_CONFIG_FORECASTS = {
  model: 'gpt-5' as const,
  reasoning: { effort: 'medium' as const },
  text: { verbosity: 'high' as const },
  max_output_tokens: 3000,
};
```

---

### 4.3 Prompt Builders (`lib/openai/prompts-gpt5.ts`)

**Key Requirements**:
- **TEGEZŐ FORM** (informal "you" for 35+ women)
- **100% Hungarian** - no English terms
- **Empathetic, warm, spiritual tone**
- **No solution keys** - analysis only
- **No elsősegély terv mention**

```typescript
export function buildMasterPrompt(
  chakraScores: Record<string, number>,
  userName: string
): string {
  return `
    RENDSZER: Te egy spirituális csakra elemző vagy...

    FELADAT: Készíts egy átfogó összefoglalót ${userName} csakra állapotáról...

    PONTSZÁMOK: ${JSON.stringify(chakraScores)}

    FORMÁTUM: JSON válasz...

    FONTOS: Tegező forma, meleg hangnem, CSAK elemzés (megoldás NEM).
  `;
}

export function buildChakraPrompt(
  chakraName: string,
  score: number,
  answers: number[], // 4 answers for this chakra
  masterContext: string
): string {
  return `
    RENDSZER: Te egy csakra szakértő vagy...

    CSAKRA: ${chakraName} (${score}/16 pont)
    VÁLASZOK: ${answers.join(', ')}
    KONTEXTUS: ${masterContext}

    FELADAT: Részletes elemzés + gyökerok + megerősítő mondatok...

    FONTOS: NE adj megoldásokat vagy tennivalókat, CSAK elemezd!
  `;
}

export function buildForecastPrompt(
  chakraScores: Record<string, number>,
  masterSummary: string
): string {
  return `
    RENDSZER: Te egy spirituális előrejelző vagy...

    FELADAT: Készíts 3 előrejelzést (6 hónap, 1 év, 2 év)...

    PONTSZÁMOK: ${JSON.stringify(chakraScores)}

    FORMÁTUM: JSON...
  `;
}
```

---

### 4.4 Report Generator (`lib/openai/report-generator-gpt5.ts`)

```typescript
import { openaiClient, GPT5_CONFIG, GPT5_CONFIG_FORECASTS } from './client-gpt5';
import { buildMasterPrompt, buildChakraPrompt, buildForecastPrompt } from './prompts-gpt5';
import { CompleteReportSchema, type CompleteReport } from './schemas-gpt5';
import type { ChakraScores, QuizAnswers } from '@/types';

export async function generateGPT5Report(
  chakraScores: ChakraScores,
  answers: QuizAnswers,
  userName: string
): Promise<CompleteReport> {

  // Phase 1: Master Analysis
  const masterPrompt = buildMasterPrompt(chakraScores, userName);
  const masterResponse = await openaiClient.chat.completions.create({
    ...GPT5_CONFIG,
    messages: [{ role: 'user', content: masterPrompt }],
    response_format: { type: 'json_object' },
  });

  const masterData = JSON.parse(masterResponse.choices[0].message.content || '{}');
  const master = MasterAnalysisSchema.parse(masterData);

  // Phase 2: Chakra Deep Dives (Parallel)
  const chakraNames = Object.keys(chakraScores);
  const chakraPromises = chakraNames.map(async (chakraName, index) => {
    const score = chakraScores[chakraName];
    const chakraAnswers = answers.slice(index * 4, (index + 1) * 4);

    const prompt = buildChakraPrompt(chakraName, score, chakraAnswers, master.osszefoglalo);

    const response = await openaiClient.chat.completions.create({
      ...GPT5_CONFIG,
      messages: [{ role: 'user', content: prompt }],
      response_format: { type: 'json_object' },
    });

    const data = JSON.parse(response.choices[0].message.content || '{}');
    return ChakraAnalysisSchema.parse(data);
  });

  const chakras = await Promise.all(chakraPromises);

  // Phase 3: Forecasts
  const forecastPrompt = buildForecastPrompt(chakraScores, master.osszefoglalo);
  const forecastResponse = await openaiClient.chat.completions.create({
    ...GPT5_CONFIG_FORECASTS,
    messages: [{ role: 'user', content: forecastPrompt }],
    response_format: { type: 'json_object' },
  });

  const forecastData = JSON.parse(forecastResponse.choices[0].message.content || '{}');
  const forecasts = ForecastSchema.parse(forecastData);

  // Validate complete report
  const completeReport: CompleteReport = {
    master,
    chakras,
    forecasts,
  };

  return CompleteReportSchema.parse(completeReport);
}
```

---

### 4.5 Fixed Exercises (`data/chakra-exercises.ts`)

```typescript
/**
 * Fixed placeholder exercises for each chakra
 * ONLY shown for blocked chakras (score 4-12)
 * Same for all users (not personalized)
 */

export const CHAKRA_EXERCISES: Record<string, string[]> = {
  'Gyökércsakra': [
    'Állj mezítláb a földön 10 percet minden reggel.',
    'Guggolj le naponta 20 alkalommal.',
    'Fogyassz gyökérzöldségeket (répa, cékla, burgonya) minden nap.',
  ],
  'Szakrális csakra': [
    'Táncolj szabadon 15 percet naponta.',
    'Vegyél meleg fürdőt illóolajokkal hetente 2-3 alkalommal.',
    'Gyakorold a csípő körzést állva.',
  ],
  'Napfonat csakra': [
    'Végezz napüdvözletet (Surya Namaskar) minden reggel.',
    'Gyakorold a mély haslélegzést 5 percig naponta.',
    'Állj ki a napra 10-15 percre délelőtt.',
  ],
  'Szív csakra': [
    'Írj hálalistát minden este 5 dologról.',
    'Öleld át magad 1 percig minden reggel.',
    'Gyakorold a szív-központú légzést 10 percig.',
  ],
  'Torok csakra': [
    'Énekelj vagy zümmögj 5 percet naponta.',
    'Mondd ki hangosan a nevedet 10-szer reggel.',
    'Gyakorold a nyakforgatást lassan, tudatosan.',
  ],
  'Harmadik szem': [
    'Meditálj 10 percet csukott szemmel naponta.',
    'Írj le 3 álmot vagy intuíciót minden reggel.',
    'Gyakorold a szemforgatást minden irányba.',
  ],
  'Korona csakra': [
    'Ülj csendben 5 percet minden reggel.',
    'Nézd az eget 10 percig naponta.',
    'Ismételj "Om" mantrát 108-szor.',
  ],
};
```

---

### 4.6 PDF Generator (`lib/pdf/report-template-gpt5.ts`)

```typescript
import jsPDF from 'jspdf';
import type { CompleteReport } from '@/lib/openai/schemas-gpt5';
import type { ChakraScores } from '@/types';
import { CHAKRA_EXERCISES } from '@/data/chakra-exercises';

export async function generateReportPDF(
  report: CompleteReport,
  chakraScores: ChakraScores,
  userName: string,
  userEmail: string
): Promise<Buffer> {

  const pdf = new jsPDF({
    orientation: 'portrait',
    unit: 'mm',
    format: 'a4',
  });

  // Page 1: Cover
  addCoverPage(pdf, userName);

  // Page 2: Summary (Master Analysis)
  pdf.addPage();
  addSummaryPage(pdf, report.master);

  // Page 3: Chakra Basics
  pdf.addPage();
  addChakraBasicsPage(pdf);

  // Pages 4-10: Chakra Detail Pages (7 pages)
  report.chakras.forEach((chakra, index) => {
    pdf.addPage();
    addChakraDetailPage(pdf, chakra, chakraScores[chakra.nev]);
  });

  // Page 11: Root Causes (Overall)
  pdf.addPage();
  addRootCausesPage(pdf, report.master.kialakulasi_okok);

  // Pages 12-13: Forecasts (3 time horizons)
  pdf.addPage();
  addForecastsPage(pdf, report.forecasts);

  // Pages 14-15: Positive Scenario
  pdf.addPage();
  addPositiveScenarioPage(pdf, report.forecasts.pozitiv_forgatokonyvv);

  // Pages 16-17: Fixed Exercises (only blocked chakras)
  const blockedChakras = Object.entries(chakraScores)
    .filter(([_, score]) => score <= 12)
    .map(([name, _]) => name);

  if (blockedChakras.length > 0) {
    pdf.addPage();
    addExercisesPage(pdf, blockedChakras);
  }

  // Page 18: Tracking Journal Template
  pdf.addPage();
  addTrackingJournalPage(pdf);

  return Buffer.from(pdf.output('arraybuffer'));
}

// Helper functions for each page...
// (Implementation details omitted for brevity)
```

**Key Points**:
- NO weekly plan page
- NO elsősegély terv page
- Fixed exercises only for blocked chakras (score ≤ 12)
- Professional typography with Hungarian fonts

---

### 4.7 API Route (`app/api/generate-detailed-report-gpt5/route.ts`)

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { createClient } from '@supabase/supabase-js';
import { generateGPT5Report } from '@/lib/openai/report-generator-gpt5';
import { generateReportPDF } from '@/lib/pdf/report-template-gpt5';

const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.SUPABASE_SERVICE_ROLE_KEY!
);

export async function POST(req: NextRequest) {
  try {
    const { result_id } = await req.json();

    // 1. Fetch quiz result
    const { data: result, error } = await supabase
      .from('quiz_results')
      .select('*')
      .eq('id', result_id)
      .single();

    if (error || !result) {
      return NextResponse.json(
        { error: 'Quiz result not found' },
        { status: 404 }
      );
    }

    // 2. Generate AI report (9 API calls)
    const report = await generateGPT5Report(
      result.chakra_scores,
      result.answers,
      result.name
    );

    // 3. Generate PDF
    const pdfBuffer = await generateReportPDF(
      report,
      result.chakra_scores,
      result.name,
      result.email
    );

    // 4. Upload to Supabase Storage
    const fileName = `detailed-report-${result_id}-${Date.now()}.pdf`;
    const { data: uploadData, error: uploadError } = await supabase.storage
      .from('detailed-reports')
      .upload(fileName, pdfBuffer, {
        contentType: 'application/pdf',
        upsert: false,
      });

    if (uploadError) {
      throw new Error(`Upload failed: ${uploadError.message}`);
    }

    // 5. Generate signed URL (30-day expiry)
    const { data: urlData } = await supabase.storage
      .from('detailed-reports')
      .createSignedUrl(fileName, 60 * 60 * 24 * 30); // 30 days

    // 6. Update purchase record with PDF URL
    await supabase
      .from('purchases')
      .update({ pdf_url: urlData?.signedUrl })
      .eq('result_id', result_id)
      .eq('product_id', 'ai_analysis_pdf');

    return NextResponse.json({
      success: true,
      pdf_url: urlData?.signedUrl,
      file_name: fileName,
    });

  } catch (error) {
    console.error('[GENERATE_REPORT_GPT5] Error:', error);
    return NextResponse.json(
      { error: 'Failed to generate report' },
      { status: 500 }
    );
  }
}
```

---

## 5. Supabase Storage Setup

### Bucket Configuration

**Bucket Name**: `detailed-reports`

**Settings**:
- **Public**: No (private bucket)
- **File Size Limit**: 10 MB
- **Allowed MIME Types**: `application/pdf`

**RLS Policies**: None (server-side access only via service role key)

**Access Pattern**:
1. Server generates PDF → uploads with service role key
2. Server generates signed URL (30-day expiry)
3. User downloads via signed URL
4. Admin can re-generate signed URL from admin panel

---

## 6. Admin Panel Integration

### Requirements

**Location**: `/admin` (existing admin panel)

**New Features**:
1. **View Detailed Report Purchases** - List all purchases with `product_id = 'ai_analysis_pdf'`
2. **Re-Download PDF** - Generate new signed URL from stored file name
3. **Re-Send Email** - Trigger email with new signed URL
4. **Regenerate Report** - Call `/api/generate-detailed-report-gpt5` again

**UI Components**:
- Table with columns: User, Email, Purchase Date, PDF Status, Actions
- "Download PDF" button → generates new signed URL
- "Re-send Email" button → triggers Resend API
- "Regenerate Report" button → calls GPT-5 API again

---

## 7. Testing Strategy

### Unit Tests

1. **Zod Schema Validation**:
   - Test with valid JSON → should pass
   - Test with invalid JSON → should throw ZodError
   - Test edge cases (min/max word counts)

2. **Prompt Builders**:
   - Verify correct chakra data insertion
   - Verify tegező form in prompts
   - Verify Hungarian language requirement

3. **Report Generator**:
   - Mock OpenAI responses
   - Test error handling (API failures)
   - Test parallel execution correctness

### Integration Tests

1. **End-to-End Flow**:
   - Create test quiz result
   - Call `/api/generate-detailed-report-gpt5`
   - Verify PDF generated and uploaded
   - Verify signed URL works
   - Verify PDF contains all 18-20 pages

2. **GPT-5 API**:
   - Test with real API (staging environment)
   - Verify JSON response format
   - Verify Hungarian language output
   - Verify tegező form usage

3. **Supabase Storage**:
   - Test upload → verify file exists
   - Test signed URL → verify download works
   - Test 30-day expiry

### Manual QA Checklist

- [ ] Complete quiz as test user
- [ ] Purchase detailed report
- [ ] Verify email received with PDF link
- [ ] Download PDF and verify all 18-20 pages
- [ ] Check Hungarian language quality
- [ ] Verify NO elsősegély terv section
- [ ] Verify NO weekly plan section
- [ ] Verify fixed exercises only for blocked chakras
- [ ] Admin panel: re-download PDF
- [ ] Admin panel: re-send email
- [ ] Admin panel: regenerate report

---

## 8. Cost Analysis

### Per Report Cost (GPT-5)

**Phase 1: Master Analysis**
- Tokens: ~2000 output
- Cost: ~$0.0002

**Phase 2: Chakra Deep Dives (7 calls)**
- Tokens: ~4000 output × 7 = 28,000
- Cost: ~$0.0028 × 7 = ~$0.0010

**Phase 3: Forecasts**
- Tokens: ~3000 output
- Cost: ~$0.0003

**Total per Report**: ~$0.0015 USD (~0.45 Ft)

**Monthly Projections**:
- 100 reports/month: ~150 Ft (~$0.50 USD)
- 500 reports/month: ~750 Ft (~$2.50 USD)

**Profit Margin**: 2,990 Ft - 0.45 Ft = **2,989.55 Ft per report** (~99.98%)

---

## 9. Error Handling

### 7-Layer Error Handling Strategy

1. **Input Validation** - Zod schemas reject invalid data
2. **API Rate Limits** - Retry logic with exponential backoff
3. **OpenAI Errors** - Catch and log, return friendly error
4. **Zod Validation Errors** - Log raw JSON, return specific error
5. **PDF Generation Errors** - Catch jsPDF errors, fallback to plain text
6. **Supabase Upload Errors** - Retry 3 times, log failure
7. **Email Errors** - Log but don't block (admin can re-send)

### Error Logging

**Format**:
```typescript
console.error('[GENERATE_REPORT_GPT5] Phase 2 Error:', {
  chakra: chakraName,
  score,
  error: error.message,
  rawResponse: response.choices[0].message.content,
});
```

**Monitoring**: Use Vercel logs + Sentry for production monitoring

---

## 10. Deployment Checklist

### Pre-Deployment

- [ ] Create Supabase bucket: `detailed-reports`
- [ ] Set environment variable: `OPENAI_API_KEY` (GPT-5 access)
- [ ] Set environment variable: `SUPABASE_SERVICE_ROLE_KEY`
- [ ] Test GPT-5 API access with simple request
- [ ] Verify jsPDF generates valid PDFs locally

### Deployment Steps

1. **Push to main branch** → Vercel auto-deploys
2. **Verify environment variables** in Vercel dashboard
3. **Test API endpoint** with test result_id
4. **Verify Supabase upload** works in production
5. **Test signed URL expiry** (30 days)

### Post-Deployment Monitoring

- Monitor Vercel function logs for errors
- Check OpenAI API usage dashboard
- Monitor Supabase storage quota
- Track email delivery success rate (Resend)

---

## 11. Success Metrics

### Technical KPIs

- **Generation Success Rate**: ≥ 98% (2% failure acceptable)
- **Average Generation Time**: ≤ 30 seconds
- **PDF Quality**: 100% valid PDFs (no corruption)
- **Zod Validation Pass Rate**: 100% (no malformed JSON)

### Business KPIs

- **Purchase Rate**: % of quiz completions → report purchases
- **Customer Satisfaction**: Track email clicks, download rates
- **Support Tickets**: Track "PDF issues" tickets (goal: < 2%)

---

## 12. Future Enhancements (v2.3+)

**Not in v2.2 scope** - consider for future versions:

1. **Upsell Integration**: Workbook upsell on report download page
2. **Email Drip Campaign**: 7-day email series with chakra tips
3. **Progress Tracking**: Allow users to retake quiz, compare reports
4. **Audio Version**: ElevenLabs narration of report
5. **Video Version**: Personalized video with AI avatar
6. **Multi-Language**: English, German versions

---

## 13. Critical Requirements Summary

**MUST HAVE** ✅:
- GPT-5 model (not GPT-4o-mini)
- Multi-prompt strategy (9 calls)
- Zod validation for all outputs
- NO elsősegély terv (removed per user request)
- NO weekly plan (reserved for upsell)
- Fixed exercises (same for all users, blocked chakras only)
- Tegező form (informal Hungarian)
- 18-20 pages PDF
- Supabase storage with admin access
- Professional code quality

**MUST NOT HAVE** ❌:
- Elsősegély terv (first aid plan)
- Weekly action plan
- Per-chakra forecasts (only 3 general forecasts)
- English text
- Solution keys or recommendations (analysis only)

---

## 14. Implementation Timeline

**Estimated Total**: 6-8 hours with multi-agent approach

**Phase 1** (2 hours): Core GPT-5 Integration
- Schemas, client, prompts, generator
- Unit tests for validation

**Phase 2** (2 hours): PDF Generation
- Template design
- Page layout implementation
- Fixed exercises integration

**Phase 3** (1.5 hours): API Route + Storage
- Endpoint implementation
- Supabase upload logic
- Error handling

**Phase 4** (1.5 hours): Admin Panel
- UI for re-download/re-send
- Testing with real data

**Phase 5** (1 hour): Testing + QA
- End-to-end flow
- Edge cases
- Production deployment

---

## 15. Contact & Support

**Developer**: Claude Code (AI Agent)
**Project Owner**: Szabolaszlo
**Documentation**: This file + `/docs/ai-context/project-structure.md`
**Support**: GitHub Issues or direct communication

---

**STATUS**: ✅ Approved - Ready for Implementation
**NEXT STEP**: Launch multi-agent implementation

---

**Change Log**:
- **2025-10-18**: Initial plan created
- **2025-10-18**: Removed "Elsősegély terv" per user request ("az elsősegély tervet azonnal vegyük ki, semmilyen megoldás kulcsot nem akarok adni, ez csak egy elemzés")
